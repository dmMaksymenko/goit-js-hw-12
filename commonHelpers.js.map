{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["('use strict');\nimport axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  const searchForm = document.querySelector('.search-form');\n  const galleryMarkup = document.querySelector('.gallery');\n  const submitBtn = document.querySelector('.search-btn');\n  const loader = document.querySelector('.loader');\n  const GALLERY_LINK = 'gallery-link';\n  const loadMoreBtn = document.querySelector('.load-more-btn');\n  submitBtn.disabled = true;\n  let page = 1;\n  let query = null;\n  let totalResult = 0;\n\n  const gallery = new SimpleLightbox(`.${GALLERY_LINK}`, {\n    captionsData: 'alt',\n    captionDelay: 250,\n  });\n\n  searchForm.elements.query.addEventListener('input', function () {\n    query = this.value.trim();\n    submitBtn.disabled = query === '';\n  });\n\n  searchForm.addEventListener('submit', async function (e) {\n    e.preventDefault();\n    query = e.target.elements.query.value.trim();\n    if (query === '') {\n      return;\n    }\n\n    searchForm.reset();\n    page = 1;\n    galleryMarkup.innerHTML = '';\n    try {\n      const { data } = await getImage(query, 1);\n      totalResult = data.totalHits;\n      loader.style.display = 'none';\n      renderImgs(data.hits);\n      submitBtn.disabled = true;\n      const maxPage = Math.ceil(totalResult / 15);\n      checkBtnStatus(maxPage);\n\n      gallery.refresh();\n      gallery.on('show.simplelightbox');\n    } catch (error) {\n      console.error('Error fetching images:', error);\n      loader.style.display = 'none';\n      onError(`Error fetching images: ${error}`);\n      submitBtn.disabled = false;\n    } finally {\n      e.target.elements.query.value = '';\n    }\n  });\n  async function getImage(query, page = 1, maxPage) {\n    const BASE_URL = 'https://pixabay.com/api/';\n\n    const searchParams = new URLSearchParams({\n      key: '42137546-386b5be41212ccd429cab5a80',\n      q: query,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safeSearch: true,\n      per_page: 15,\n      page: page,\n    });\n    const Params = `?${searchParams}`;\n    const url = BASE_URL + Params;\n\n    try {\n      const response = await axios.get(url, {\n        params: { ...searchParams },\n      });\n      if (!response.data) {\n        throw new Error('No data returned from the API');\n      }\n      const data = response.data;\n\n      return { data, maxPage, page };\n    } catch (error) {\n      throw new Error(`Error fetching images: ${error.message}`);\n    }\n  }\n\n  function checkBtnStatus(maxPage) {\n    if (totalResult === 0 || page >= maxPage) {\n      loadMoreBtn.style.display = 'none';\n      iziToast.show({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        color: 'red',\n        position: 'topRight',\n      });\n    } else {\n      loadMoreBtn.style.display = 'block';\n    }\n  }\n  loadMoreBtn.addEventListener('click', loadMoreImages);\n\n  function imgTemplate({\n    webformatURL,\n    largeImageURL,\n    tags,\n    likes,\n    views,\n    comments,\n    downloads,\n  }) {\n    return `\n  <a href=\"${largeImageURL}\" class=\"${GALLERY_LINK} id=\"gallery-link\">\n     <figure>\n      <img src=\"${webformatURL}\" alt=\"${tags}\" class=\"gallery-image\">\n      <figcaption class=\"gallery__figcaption\">\n        <p class=\"image-item\">Likes <span class=\"image-caption\">${likes}</span></p>\n        <p class=\"image-item\">Views <span class=\"image-caption\">${views}</span></p>\n        <p class=\"image-item\">Comments <span class=\"image-caption\">${comments}</span></p>\n        <p class=\"image-item\">Downloads <span class=\"image-caption\">${downloads}</span></p>\n  </figcaption>\n  </figure>\n</a>`;\n  }\n\n  function imgsTemplate(imgs) {\n    return imgs.map(imgTemplate).join('');\n  }\n\n  function renderImgs(images) {\n    if (images.length === 0) {\n      iziToast.show({\n        icon: 'icon-close',\n        messageSize: '16px',\n        backgroundColor: `red`,\n        position: 'topRight',\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n      });\n      loadMoreBtn.style.display = 'none';\n      galleryMarkup.innerHTML = '';\n      return;\n    }\n\n    const markup = imgsTemplate(images);\n    try {\n      galleryMarkup.insertAdjacentHTML('beforeend', markup);\n      totalResult += images.length;\n    } finally {\n      loader.style.display = 'none';\n    }\n  }\n\n  async function loadMoreImages() {\n    page++;\n    loader.style.display = 'block';\n    try {\n      const { data } = await getImage(query, page);\n      renderImgs(data.hits);\n      const maxPage = Math.ceil(data.totalHits / 15);\n      checkBtnStatus(maxPage);\n      gallery.refresh();\n      const imageElements = document.querySelectorAll('.gallery-link');\n      const imageHeight =\n        imageElements.length > 0 ? imageElements[0].offsetHeight : 0;\n      const scrollHeight = imageHeight * 2;\n      window.scrollBy({\n        behavior: 'smooth',\n        top: scrollHeight,\n      });\n    } catch (error) {\n      console.error('Error fetching more images:', error);\n      onError(`Error fetching more images: ${error}`);\n    } finally {\n      loader.style.display = 'none';\n    }\n  }\n\n  function onError(message) {\n    iziToast.show({\n      message,\n      backgroundColor: '#59A10D',\n      progressBarColor: '#B5EA7C',\n      icon: 'icon-check',\n    });\n  }\n});\n"],"names":["searchForm","galleryMarkup","submitBtn","loader","GALLERY_LINK","loadMoreBtn","page","query","totalResult","gallery","SimpleLightbox","data","getImage","renderImgs","maxPage","checkBtnStatus","error","onError","BASE_URL","searchParams","Params","url","response","axios","iziToast","loadMoreImages","imgTemplate","webformatURL","largeImageURL","tags","likes","views","comments","downloads","imgsTemplate","imgs","images","markup","imageElements","scrollHeight","message"],"mappings":"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"}